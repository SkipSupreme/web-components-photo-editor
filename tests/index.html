<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Photo Editor - Test Suite</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, monospace;
      background: #1a1a1a;
      color: #fff;
      padding: 20px;
      min-height: 100vh;
    }

    h1 {
      font-size: 24px;
      margin-bottom: 20px;
      color: #3b82f6;
    }

    .status {
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 14px;
    }

    .status.running {
      background: #1e3a5f;
      border: 1px solid #3b82f6;
    }

    .status.success {
      background: #14532d;
      border: 1px solid #22c55e;
    }

    .status.failure {
      background: #450a0a;
      border: 1px solid #ef4444;
    }

    .results {
      background: #2a2a2a;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 16px;
      overflow: auto;
      max-height: 70vh;
    }

    .suite {
      margin-bottom: 20px;
    }

    .suite-name {
      font-size: 16px;
      font-weight: 600;
      color: #60a5fa;
      margin-bottom: 8px;
      padding-bottom: 4px;
      border-bottom: 1px solid #444;
    }

    .test {
      padding: 4px 0;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .test.passed {
      color: #22c55e;
    }

    .test.failed {
      color: #ef4444;
    }

    .test-icon {
      width: 16px;
    }

    .error-details {
      background: #450a0a;
      padding: 8px 12px;
      margin: 4px 0 4px 24px;
      border-radius: 4px;
      font-size: 11px;
      color: #fca5a5;
      white-space: pre-wrap;
    }

    .summary {
      display: flex;
      gap: 20px;
      margin-top: 20px;
      padding-top: 16px;
      border-top: 1px solid #444;
      font-size: 14px;
    }

    .summary-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .summary-count {
      font-size: 20px;
      font-weight: 600;
    }

    .summary-count.passed { color: #22c55e; }
    .summary-count.failed { color: #ef4444; }
    .summary-count.total { color: #60a5fa; }

    #console-output {
      background: #111;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 16px;
      margin-top: 20px;
      font-family: monospace;
      font-size: 12px;
      max-height: 300px;
      overflow: auto;
      white-space: pre-wrap;
    }

    .action-buttons {
      margin-bottom: 20px;
    }

    .btn {
      padding: 10px 20px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      margin-right: 10px;
    }

    .btn-primary {
      background: #3b82f6;
      color: white;
    }

    .btn-primary:hover {
      background: #2563eb;
    }

    .btn-secondary {
      background: #333;
      color: #fff;
      border: 1px solid #555;
    }

    .btn-secondary:hover {
      background: #444;
    }
  </style>
</head>
<body>
  <h1>Photo Editor Test Suite</h1>

  <div class="action-buttons">
    <button class="btn btn-primary" id="run-tests">Run All Tests</button>
    <button class="btn btn-secondary" id="clear-results">Clear Results</button>
  </div>

  <div class="status running" id="status">
    Click "Run All Tests" to start...
  </div>

  <div class="results" id="results">
    <div style="color: #888;">Test results will appear here...</div>
  </div>

  <div id="console-output"></div>

  <script type="module">
    import { TestRunner, assert } from './test-runner.js';

    // Capture console output
    const consoleOutput = document.getElementById('console-output');
    const originalLog = console.log;
    console.log = (...args) => {
      originalLog(...args);
      consoleOutput.textContent += args.join(' ') + '\n';
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
    };

    // Import all test modules
    async function loadTests() {
      const modules = await Promise.all([
        import('./core.test.js'),
        import('./document.test.js'),
        import('./tools.test.js'),
        import('./storage.test.js')
      ]);
      return modules.map(m => Object.values(m)[0]);
    }

    // Display results in UI
    function displayResults(allResults) {
      const resultsEl = document.getElementById('results');
      const statusEl = document.getElementById('status');

      let html = '';
      let totalPassed = 0;
      let totalFailed = 0;

      for (const { runner, results } of allResults) {
        for (const suite of runner.suites) {
          html += `<div class="suite">`;
          html += `<div class="suite-name">${suite.name}</div>`;

          for (const test of suite.tests) {
            const error = results.errors.find(
              e => e.suite === suite.name && e.test === test.description
            );
            const status = error ? 'failed' : 'passed';
            const icon = error ? '❌' : '✅';

            html += `<div class="test ${status}">`;
            html += `<span class="test-icon">${icon}</span>`;
            html += `<span>${test.description}</span>`;
            html += `</div>`;

            if (error) {
              html += `<div class="error-details">${error.error}</div>`;
            }
          }

          html += `</div>`;
        }

        totalPassed += results.passed;
        totalFailed += results.failed;
      }

      // Summary
      html += `<div class="summary">`;
      html += `<div class="summary-item"><span class="summary-count total">${totalPassed + totalFailed}</span> Total</div>`;
      html += `<div class="summary-item"><span class="summary-count passed">${totalPassed}</span> Passed</div>`;
      html += `<div class="summary-item"><span class="summary-count failed">${totalFailed}</span> Failed</div>`;
      html += `</div>`;

      resultsEl.innerHTML = html;

      // Update status
      if (totalFailed === 0) {
        statusEl.className = 'status success';
        statusEl.textContent = `✅ All ${totalPassed} tests passed!`;
      } else {
        statusEl.className = 'status failure';
        statusEl.textContent = `❌ ${totalFailed} of ${totalPassed + totalFailed} tests failed`;
      }
    }

    // Run all tests
    async function runAllTests() {
      const statusEl = document.getElementById('status');
      const resultsEl = document.getElementById('results');

      statusEl.className = 'status running';
      statusEl.textContent = 'Running tests...';
      resultsEl.innerHTML = '<div style="color: #888;">Loading test modules...</div>';
      consoleOutput.textContent = '';

      try {
        const runners = await loadTests();
        const allResults = [];

        for (const runner of runners) {
          const results = await runner.run();
          allResults.push({ runner, results });
        }

        displayResults(allResults);
      } catch (error) {
        statusEl.className = 'status failure';
        statusEl.textContent = `Error loading tests: ${error.message}`;
        console.error(error);
      }
    }

    // Event listeners
    document.getElementById('run-tests').addEventListener('click', runAllTests);
    document.getElementById('clear-results').addEventListener('click', () => {
      document.getElementById('results').innerHTML = '<div style="color: #888;">Test results will appear here...</div>';
      document.getElementById('status').className = 'status running';
      document.getElementById('status').textContent = 'Click "Run All Tests" to start...';
      consoleOutput.textContent = '';
    });
  </script>
</body>
</html>
